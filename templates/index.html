<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Description Generator</title>
    <style>
       @import url('https://fonts.googleapis.com/css2?family=Open+Sans&family=Lato&family=Roboto&family=Inter&display=swap');
      body {
        font-family: Arial, sans-serif;
        background: #e7e9ee;
        padding: 20px;
      }
      .container {
        width: 100%;
        max-width: 700px;
        margin: 0 auto;
      }
      .form-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 15px;
      }
      label {
        display: block;
        font-weight: bold;
        margin-bottom: 5px;
      }
      .required:after {
        content: " *";
        color: red;
      }
      select, input[type="text"], input[type="date"], input[type="number"] {
        padding: 10px;
        width: 100%;
        max-width: 300px;
        border-radius: 20px;
        border: 1px solid #ccc;
        box-sizing: border-box;
      }
      .radio-group input {
        margin-right: 5px;
      }
      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 10px;
        background: #007bff;
        color: white;
        cursor: pointer;
        transition: background 0.2s, transform 0.1s;
        min-width: calc(100% - 40px);
        display: inline-block;
      }
      .radio-group {
        display: flex;
        gap: 30px;
        align-items: center;
        flex-wrap: wrap;
        margin-top: 5px;
      }
      .radio-group label {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: normal;
        margin: 0;
      }
      .radio-group input[type="checkbox"],
      .radio-group input[type="radio"] {
        margin: 0;
        transform: scale(1.1);
      }
      .btn:hover {
        background: #0056b3;
      }
      .btn:active {
        transform: scale(0.97);
        background: #004a99;
      }
      #freshers, #experienced {
        margin-right: 5px;
      }
      #companyName, #companyType, #postFor, #postType, #address, #title, #package, #lastDate, #vacancy, #skills, #keywords, #wordCount, #description {
        min-width: calc(100% - 40px);
        display: inline-block;
      }
      #chatbox {
        min-width: calc(100% - 40px);
        display: inline-block;
        position: static;
        margin-top: 20px;
        background: white;
        padding: 15px;
        border-radius: 10px;
        width: 100%;
        max-width: 320px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
      }
      #descriptionResult {
        width: 100%;
        height: 800px;
        max-height: 800px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background: #f8f9fa;
        resize: none;
        box-sizing: border-box;
        font-family: inherit;
        white-space: pre-wrap;
        overflow-y: auto;
        overflow-x: hidden;
      }
      #salaryRange {
        display: none;
        margin-top: 10px;
      }
      #downloadBtn, #copyBtn {
        display: none;
        margin-top: 10px;
      }
      #downloadBtn {
        background: #28a745;
      }
      #copyBtn {
        background: #28a745;
      }
      @media (max-width: 480px) {
        select,
        input[type="text"],
        input[type="date"],
        input[type="number"] {
          width: 100%;
          max-width: 100%;
        }
        #chatbox {
          position: static;
          margin-top: 20px;
          width: 100%;
          max-width: none;
        }
      }
      .toolbar {
        margin-bottom: 10px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .toolbar button {
        padding: 6px 10px;
        font-size: 16px;
        border-radius: 6px;
        border: 1px solid #ccc;
        background: white;
        cursor: pointer;
      }
      .toolbar button:hover {
        background: #ddd;
      }
      textarea {
        padding: 10px;
        width: 100%;
        max-width: 300px;
        border-radius: 20px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        font-family: inherit;
        display: inline-block;
      }
      .error-message {
        color: red;
        font-size: 12px;
        margin-top: 5px;
      }
      .title-group {
        display: flex;
        gap: 10px;
        align-items: center;
        width: 100%;
        max-width: 300px;
      }
      .title-group input[type="text"] {
        width: 100%;
        max-width: none;
      }
      @media (max-width: 480px) {
        .title-group {
          flex-direction: column;
          align-items: stretch;
        }
        .title-group input[type="text"] {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Description Generator</h2>
      <div class="form-group">
        <label for="companyType" class="required">Recruiter Type:</label>
        <select id="companyType" required>
          <option value="">Select</option>
          <option>Adept</option>
          <option>Entrepreneur</option>
        </select>
        <span id="companyType-error" class="error-message"></span>
      </div>

      <div class="form-group">
        <label for="companyName">Company Name:</label>
        <input type="text" id="companyName" placeholder="Not required for Adept recruitment – leave blank or enter 'Individual' if hiring personally." />
        <span id="companyName-error" class="error-message"></span>
      </div>
      
      <div class="form-group">
        <label for="postFor" class="required">Post For:</label>
        <select id="postFor" required>
          <option value="">Select</option>
          <option>For my company</option>
          <option>For myself</option>
        </select>
        <span id="postFor-error" class="error-message"></span>
      </div>

      <div class="form-group">
        <label for="postType" class="required">Post Type:</label>
        <select id="postType" required>
          <option value="">Select</option>
          <option>Internship (Stipend)</option>
          <option>Internship (Unpaid)</option>
          <option>Part time</option>
          <option>Full time</option>          
          <option>Contract</option>
          <option>Project (freelancers)</option>
          <option>Project (Service companies)</option>
        </select>
        <span id="postType-error" class="error-message"></span>
      </div>

      <div class="form-group">
        <label>Eligibility Criteria:</label>
        <div class="radio-group">
          <label for="freshers">
            <input type="checkbox" id="freshers" value="Freshers"> Freshers
          </label>
          <label for="experienced">
            <input type="checkbox" id="experienced" value="Experienced"> Experienced
          </label>
        </div>
      </div>

      <div class="form-group">
        <label class="required">Location:</label>
        <div class="radio-group">
          <label>
            <input type="radio" name="location" value="Onsite" checked> Onsite
          </label>
          <label>
            <input type="radio" name="location" value="Remote"> Remote
          </label>
          <label>
            <input type="radio" name="location" value="Hybrid"> Hybrid
          </label>
        </div>
      </div>

      <div class="form-group">
        <label for="address" class="required">Address:</label>
        <input type="text" id="address" placeholder="Enter Address" required>
        <span id="address-error" class="error-message"></span>
      </div>

      <div class="form-group">
        <label class="required">Title:</label>
        <div class="title-group">
          <input type="text" id="title" placeholder="Enter Job Title (e.g., Software Engineer)" required>
        </div>
        <span id="title-error" class="error-message"></span>
      </div>

      <div class="form-group">
        <label for="package" class="required">Package:</label>
        <input type="text" id="package" placeholder="Click to enter range" readonly onclick="showSalaryRange()" required>
        <div id="salaryRange" style="display: none; margin-top: 10px;">
          <input type="number" id="salaryFrom" placeholder="From ₹" oninput="updatePackageValue()" />
          <input type="number" id="salaryTo" placeholder="To ₹" oninput="updatePackageValue()" />
        </div>
        <span id="package-error" class="error-message"></span>
      </div>

      <div class="form-group">
        <label for="lastDate" class="required">Last Date for submission:</label>
        <input type="date" id="lastDate" required>
        <span id="lastDate-error" class="error-message"></span>
      </div>

      <div class="form-group">
        <label for="vacancy" class="required">No. of Vacancy:</label>
        <input type="number" id="vacancy" value="0" min="0" required>
        <span id="vacancy-error" class="error-message"></span>
      </div>

      <div class="form-group">
        <label for="skills" class="required">Skills:</label>
        <input type="text" id="skills" placeholder="Comma separated" required>
        <span id="skills-error" class="error-message"></span>
      </div>

      <div class="form-group">
        <label for="keywords" class="required">Keywords:</label>
        <input type="text" id="keywords" placeholder="Comma separated" required>
        <span id="keywords-error" class="error-message"></span>
      </div>

      <div class="form-group">
        <label for="description">Describe the Post:</label>
        <textarea id="description" rows="4" placeholder="Describe the type of post and for whom it is meant..."></textarea>
        <span id="description-error" class="error-message"></span>
      </div>

      <div class="form-group">
        <label>Other Benefits:</label>
        <div class="radio-group" style="flex-wrap: wrap; gap: 10px;">
          <label>
            <input type="checkbox" value="Transport">
            <img src="https://cdn-icons-png.flaticon.com/512/854/854894.png" width="30" alt="Transport">
            Transport
          </label>
          <label>
            <input type="checkbox" value="Food & Beverages">
            <img src="https://cdn-icons-png.flaticon.com/512/1046/1046784.png" width="30" alt="Food">
            Food & Beverages
          </label>
          <label>
            <input type="checkbox" value="Medical Insurance">
            <img src="https://cdn-icons-png.flaticon.com/512/2209/2209673.png" width="30" alt="Insurance">
            Medical Insurance
          </label>
          <label>
            <input type="checkbox" value="Employee Stock Options">
            <img src="https://cdn-icons-png.flaticon.com/512/1029/1029183.png" width="30" alt="Stock">
            Employee Stock
          </label>
        </div>
      </div>

      <div class="form-group">
        <label for="wordCount">Number of Words for Description (Optional):</label>
        <input type="number" id="wordCount" placeholder="e.g. 200">
        <span id="wordCount-error" class="error-message"></span>
      </div>

      <div class="form-group">
        <button class="btn" onclick="generateDescription()">
          <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png" alt="Chatbot" width="30" style="vertical-align: middle;">
          Generate
        </button>
      </div>

      <div id="chatbox">
        <div class="toolbar">
          <button onclick="formatText('bold')"><b>B</b></button>
          <button onclick="formatText('italic')"><i>I</i></button>
          <button onclick="formatText('underline')"><u>U</u></button>
          <button onclick="formatText('justifyLeft')">⯇</button>
          <button onclick="formatText('justifyCenter')">≡</button>
          <button onclick="formatText('justifyRight')">⯈</button>
          <button onclick="formatText('undo')">↺</button>
          <button onclick="formatText('redo')">↻</button>
          <select id="fontSelector" onchange="changeFont(this.value)">
            <option value="">Font Style</option>
            <option value="Helvetica">Helvetica</option>
            <option value="Arial">Arial</option>
            <option value="Roboto">Roboto</option>
            <option value="Open Sans">Open Sans</option>
            <option value="Lato">Lato</option>
            <option value="Segoe UI">Segoe UI</option>
            <option value="Inter">Inter</option>
            <option value="Times New Roman">Times New Roman</option>
          </select>
        </div>
        <div id="descriptionResult" contenteditable="true" placeholder="Generated description will appear here..."></div>
        <p style="margin-top: 10px; color: #555;">
          You can make changes according to your preferences or edit accordingly.
        </p>
        <button id="downloadBtn" class="btn" onclick="downloadDescription()">
          Download Description
        </button>
        <button id="copyBtn" class="btn" onclick="copyToClipboard()">
          Copy to Clipboard
        </button>
      </div>
    </div>

    <script>
      function showSalaryRange() {
        document.getElementById('salaryRange').style.display = 'block';
        document.getElementById("salaryFrom").focus();
      }

      function updatePackageValue() {
        const from = document.getElementById("salaryFrom").value;
        const to = document.getElementById("salaryTo").value;
        const packageInput = document.getElementById("package");

        if (from && to) {
          packageInput.value = `₹${from} - ₹${to}`;
        }
      }

      function clearErrors() {
        const errorElements = document.querySelectorAll('.error-message');
        errorElements.forEach(el => el.textContent = '');
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => input.style.border = '');
      }

      function setError(field, message) {
        const errorEl = document.getElementById(`${field}-error`);
        const input = document.getElementById(field);
        if (errorEl && input) {
          errorEl.textContent = message;
          input.style.border = "2px solid red";
          input.scrollIntoView({ behavior: 'smooth', block: 'center' });
          input.focus();
        }
      }

      function validateFields() {
        const fields = [
          { id: "companyType", message: "Required: Please select a Recruiter Type" },
          { id: "postFor", message: "Required: Please select Post For" },
          { id: "postType", message: "Required: Please select a Post Type" },
          { id: "address", message: "Required: Please fill this field" },
          { id: "title", message: "Required: Please enter a Job Title" },
          { id: "package", message: "Required: Please enter a salary range" },
          { id: "lastDate", message: "Required: Please select a date" },
          { id: "vacancy", message: "Required: Vacancy must be a positive number", validate: value => parseInt(value) > 0 },
          { id: "skills", message: "Required: At least one skill is required", validate: value => value.split(',').map(s => s.trim()).filter(s => s).length > 0 },
          { id: "keywords", message: "Required: At least one keyword is required", validate: value => value.split(',').map(k => k.trim()).filter(k => k).length > 0 }
        ];

        clearErrors();

        for (const field of fields) {
          const input = document.getElementById(field.id);
          const value = input.value.trim();
          const isValid = field.validate ? field.validate(value) : value !== "";
          if (!isValid) {
            setError(field.id, field.message);
            return false;
          }
        }
        return true;
      }

      function generateDescription() {
        if (!validateFields()) {
          return;
        }

        const resultEl = document.getElementById("descriptionResult");
        resultEl.innerHTML = "<em>Generating description... please wait.</em>";
        resultEl.setAttribute("contenteditable", "false");
        document.getElementById("chatbox").style.display = "block";
        document.getElementById("downloadBtn").style.display = "none";
        document.getElementById("copyBtn").style.display = "none";

        const packageVal = document.getElementById("package").value;
        const salaryFrom = document.getElementById("salaryFrom").value;
        const salaryTo = document.getElementById("salaryTo").value;
        const salaryRange = salaryFrom && salaryTo ? `₹${salaryFrom} - ₹${salaryTo}` : packageVal;

        const eligibility = [];
        if (document.getElementById("freshers")?.checked) eligibility.push("Freshers");
        if (document.getElementById("experienced")?.checked) eligibility.push("Experienced");

        const benefitCheckboxes = document.querySelectorAll('div.form-group input[type="checkbox"]:checked');
        const benefits = Array.from(benefitCheckboxes)
          .filter(checkbox => checkbox.value && !["Freshers", "Experienced"].includes(checkbox.value))
          .map(cb => cb.value);

        const payload = {
          companyName: document.getElementById("companyName").value,
          companyType: document.getElementById("companyType").value,
          postFor: document.getElementById("postFor").value,
          postType: document.getElementById("postType").value,
          location: document.querySelector('input[name="location"]:checked').value,
          address: document.getElementById("address").value,
          title: document.getElementById("title").value,
          package: salaryRange,
          lastDate: document.getElementById("lastDate").value,
          vacancy: parseInt(document.getElementById("vacancy").value),
          skills: document.getElementById("skills").value,
          keywords: document.getElementById("keywords").value,
          description: document.getElementById('description').value,
          wordCount: document.getElementById("wordCount").value || null,
          eligibility: eligibility,
          benefits: benefits
        };

        fetch('http://127.0.0.1:4000/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        })
        .then(response => {
          if (!response.ok) {
            return response.json().then(err => { throw err; });
          }
          return response.json();
        })
        .then(data => {
          resultEl.innerHTML = data.description;
          resultEl.setAttribute("contenteditable", "true");
          document.getElementById("chatbox").style.display = "block";
          document.getElementById("downloadBtn").style.display = "inline-block";
          document.getElementById("copyBtn").style.display = "inline-block";
        })
        .catch(error => {
          console.error('Error:', error);
          if (error.field) {
            setError(error.field, `Required: ${error.error}`);
          } else {
            resultEl.innerText = "Something went wrong!";
          }
          document.getElementById("chatbox").style.display = "block";
          document.getElementById("downloadBtn").style.display = "none";
          document.getElementById("copyBtn").style.display = "none";
        });
      }

      function formatText(command) {
        document.execCommand(command, false, null);
      }

      function copyToClipboard() {
        const content = document.getElementById('descriptionResult').innerHTML;
        const tempElem = document.createElement("div");
        tempElem.innerHTML = content;
        const text = tempElem.innerText;

        navigator.clipboard.writeText(text).then(() => {
          alert("Copied to clipboard!");
        });
      }

      function downloadDescription() {
        const content = document.getElementById('descriptionResult').innerHTML;
        const text = content.replace(/<[^>]+>/g, '');
        const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "description.txt";
        link.click();
      }

      function changeFont(fontName) {
        document.execCommand("fontName", false, fontName);
      }

      document.addEventListener("DOMContentLoaded", function() {
        const dateInput = document.getElementById("lastDate");

        if (dateInput && typeof dateInput.showPicker === 'function') {
          dateInput.addEventListener("focus", function () {
            this.showPicker();
          });
        }
      });
    </script>
  </body>
</html>